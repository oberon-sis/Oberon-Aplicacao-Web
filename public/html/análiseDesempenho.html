<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Análise de Desempenho e Tendências - OBERON</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../css/body.css" />
    <link rel="stylesheet" href="../component/menu/Menu.css" />
    <link rel="stylesheet" href="../component/notificao/Notificaocao.css" />
    <link rel="stylesheet" href="../component/tour/TourGuide.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="icon" type="image/x-icon" href="../assets/marca/icone_pequeno.svg" />
    <link rel="stylesheet" href="../css/analiseGeral.css">
    <style>
        .saber_mais {
            /* Ajustado para ser mais compacto e não ter altura/largura fixa na div */
            padding: 0;
            margin-left: 5px;
            line-height: 1;
        }

        .icone-info {
            height: 16px;
            width: 16px;
        }
    </style>
</head>

<body class="d-flex w-100 h-100">
    <div id="menu-container">
    </div>

    <main class="content flex-grow-1 padding_main dashboard-main">
        <header class="header-top d-flex justify-content-between align-items-center mb-4">
            <h2 class="text-black mb-0" style="font-size: 1.5rem;">
                Análise de Desempenho e Tendências
            </h2>

            <div class="d-flex align-items-center">
                <div class="dropdown me-3" id="machine-filter-group">
                    <button class="btn btn-outline-secondary dropdown-toggle btn-sm" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false" id="machineFilterDropdown">
                        Todas as Máquinas
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="machineFilterDropdown">
                        <li><a class="dropdown-item" href="#"
                                onclick="selecionarFiltroMaquina('Todas as Máquinas')">Todas as Máquinas</a></li>
                        <li><a class="dropdown-item" href="#"
                                onclick="selecionarFiltroMaquina('Máquina Específica')">Máquina Específica</a></li>
                    </ul>
                </div>

                <div class="dropdown me-3" id="specific-machine-dropdown-group" style="display: none;">
                    <button class="btn btn-outline-secondary dropdown-toggle btn-sm" type="button"
                        data-bs-toggle="dropdown" aria-expanded="false" id="machineFilterDropdown">
                        Selecionar Máquina
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="machineFilterDropdown">
                        <li><a class="dropdown-item" href="#"
                                onclick="filtrar_maquina('Maquina-001', 1)">Maquina-001</a></li>
                        <li><a class="dropdown-item" href="#"
                                onclick="filtrar_maquina('Maquina-002', 2)">Maquina-002</a></li>
                        <li><a class="dropdown-item" href="#"
                                onclick="filtrar_maquina('Maquina-003', 3)">Maquina-003</a></li>
                    </ul>
                </div>

                <div id="notificacao-container" class="position-relative">
                </div>
            </div>
        </header>

        <div class="mb-3">
            <a class="d-block text-decoration-none text-dark" data-bs-toggle="collapse" href="#filterCollapse"
                role="button" aria-expanded="false" aria-controls="filterCollapse" onclick="toggleFilterArrow(this)">
                <div class="d-flex gap-4 align-content-center">

                    <h4 class="filtragem">
                        Filtragem de dados
                        <i class="bi bi-caret-down-fill ms-2 float-end"></i>
                    </h4>
                    <h4 style="font-size: 1.2rem; margin-bottom: 0; display: flex; align-items: center;">
                        Filtro atual: Análise de previsão da taxa de uptime, agrupado por mês, no período de
                        30/10/2025 até 09/03/3409.
                    </h4>
                </div>
            </a>
        </div>
<div class="collapse card-filter" id="filterCollapse">
    <div class="row g-3">
        <div class="col-md-4">
            <label class="form-label">Tipo de Gráfico</label>
            <select class="form-select form-select-sm" id="selectTipoGrafico" onchange="toggleFilterFields()">
                <option value="comparar" selected>Tendência – ótimo para ver se está aumentando ou diminuindo.</option>
                <option value="Previsoes">Previsões – use para prever dados futuros relacionadas.</option>
                <option value="Correlacao">Correlação – use para comparar duas variáveis e entender se estão
                    relacionadas.</option>
            </select>
        </div>

        <div class="col-md-4" id="divTempo">
            <label class="form-label">Período de Análise</label>
            <select class="form-select form-select-sm" id="selectTempo" onchange="toggleFilterFields()">
                </select>
        </div>

        <div class="col-md-4">
            <label class="form-label" id="labelMetricaPrincipal">Métrica a analisar</label>
            <select class="form-select form-select-sm" id="selectMetricaPrincipal" onchange="toggleFilterFields()">
                </select>
        </div>

        <div class="col-md-4" id="divComponente" style="display: none;">
            <label class="form-label">Componente</label>
            <select class="form-select form-select-sm" id="selectComponente" onchange="toggleFilterFields()">
                </select>
        </div>

        <div class="col-md-4" id="divVariavelRelacionada" style="display: none;">
            <label class="form-label">Variável relacionada</label>
            <select class="form-select form-select-sm" id="selectVariavelRelacionada">
                </select>
        </div>

        <div class="col-md-12" id="divDetalhesPrevisao" style="display: none;">
            <hr>
            <h6 class="text-secondary">(Selecionado automaticamente pelo sistema)</h6>
            <p class="mb-0">
                <i class="bi bi-clock-history me-1"></i>
                Histórico Usado: <span id="periodoHistorico"></span>
            </p>
            <h5 class="mt-2 mb-0" style="color: #0c8186;">
                <i class="bi bi-magic me-1"></i>
                Período Previsto: <span id="periodoPrevisto"></span>
            </h5>
        </div>

        <div class="col-12 text-end">
            <button class="btn btn-info btn-sm" onclick="aplicarFiltro()">
                <i class="bi bi-funnel-fill me-1"></i> Aplicar Filtro
            </button>
        </div>
    </div>

    <div class="mt-3 row" id="specific-machine-dropdown" style="display: none;">
        <div class="col-4">
            <label class="form-label">Selecione a Máquina</label>
            <select class="form-select form-select-sm">
            </select>
        </div>
    </div>
</div>
        <section class="row row-cols-sm-1 row-cols-md-2 row-cols-lg-4 g-3 mb-4">

            <div class="col">
                <div class="kpi-card-geral">
                    <div class="kpi-header">
                        <span class="kpi-title-geral" id="kpi_uptime_titulo">Taxa de disponibilidade (Uptime)</span>
                        <div class="kpi-icon-wrapper"><i class="bi bi-pc-display"></i></div>
                    </div>
                    <div class="kpi-content">
                        <span class="kpi-value-geral" id="kpi_uptime_valor">placeholder</span>
                        <span class="kpi-variation text-success" id="kpi_uptime_variacao">placeholder</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <p class="kpi-small-text mb-0 " id="kpi_uptime_passado">passado: placeholder</p>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus"
                            data-bs-title="Taxa de Disponibilidade (Uptime)"
                            data-bs-content="Porcentagem de tempo em que a(s) máquina(s) esteve(ram) operacional(is) no período.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="kpi-card-geral">
                    <div class="kpi-header">
                        <span class="kpi-title-geral" id="kpi_alertas_totais_titulo">Total de Alertas</span>
                        <div class="kpi-icon-wrapper"><i class="bi bi-bar-chart-fill"></i></div>
                    </div>
                    <div class="kpi-content">
                        <span class="kpi-value-geral" id="kpi_alertas_totais_valor">placeholder</span>
                        <span class="kpi-variation text-danger" id="kpi_alertas_totais_variacao">placeholder</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <p class="kpi-small-text mb-0" id="kpi_alertas_totais_passado">passado: placeholder</p>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="Total de Alertas"
                            data-bs-content="Contagem total de notificações (Crítico, Atenção, Ocioso) geradas no período analisado.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="kpi-card-geral">
                    <div class="kpi-header">
                        <span class="kpi-title-geral" id="kpi_criticos_titulo">Total de Alertas Críticos</span>
                        <div class="kpi-icon-wrapper"><i class="bi bi-exclamation-triangle-fill text-warning"></i></div>
                    </div>
                    <div class="kpi-content">
                        <span class="kpi-value-geral" id="kpi_criticos_valor">placeholder</span>
                        <span class="kpi-variation text-success" id="kpi_criticos_variacao">placeholder</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <p class="kpi-small-text mb-0" id="kpi_criticos_passado">Mês Passado: placeholder</p>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="Total de Alertas Críticos"
                            data-bs-content="Contagem total de alertas no nível máximo de severidade (Crítico) no período.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="kpi-card-geral">
                    <div class="kpi-header">
                        <span class="kpi-title-geral" id="kpi_frequente_titulo">Métrica Mais Frequente de Alerta</span>
                        <div class="kpi-icon-wrapper"><i class="bi bi-cpu"></i></div>
                    </div>
                    <div class="kpi-content">
                        <span class="kpi-value-geral" style="font-size: 1.5rem;"
                            id="kpi_frequente_nome">Cplaceholder</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <p class="kpi-small-text mb-0" id="kpi_frequente_detalhe">placeholder</p>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus"
                            data-bs-title="Métrica de Alerta Frequente"
                            data-bs-content="O recurso (CPU, RAM, Disco) que gerou o maior volume de alertas Críticos no período.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section class="row g-4 mb-4 align-items-stretch">

            <div class="col-lg-9 h-100 ">
                <div class="content-box h-100">
                    <h5 class="mb-3" style="font-size: 1.1rem;" id="titulo_grafico">Evolução Temporal de Desempenho

                        <p class="text-muted small mb-3" id="modelInfoDisplay"></p>

                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus"
                            data-bs-title="Análise de Tendência e Correlação"
                            data-bs-content="Gráfico utilizado para visualizar a progressão de uma métrica no tempo (Tendência/Previsão) ou a relação entre duas variáveis (Correlação).">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </h5>

                    <div class="chart-skeleton d-flex">
                        procurando dados....
                    </div>
                    <canvas id="alertTrendChart" class="d-none"></canvas>
                </div>
            </div>

            <div class="col-lg-3 h-100 d-flex">
                <div class="content-box w-100 p-0">

                    <div class="d-flex justify-content-between text-center border-bottom" id="info-tabs"
                        style="height: 40px;">
                        <button class="btn btn-sm flex-fill rounded-0 toggle-button active" data-target="interpretacoes"
                            onclick="toggleInfoPanel(this)"
                            style="border-bottom: 2px solid #000; font-weight: 600; color: #000; background-color: transparent;">
                            Interpretações
                        </button>
                        <button class="btn btn-sm flex-fill rounded-0 toggle-button" data-target="metricas"
                            onclick="toggleInfoPanel(this)"
                            style="border-bottom: 2px solid transparent; font-weight: 600; color: #6c757d; background-color: transparent;">
                            Métricas
                        </button>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus"
                            data-bs-title="Análise Preditiva e Métricas"
                            data-bs-content="Resultados de modelos de Machine Learning (Regressão Linear) usados para gerar previsões e interpretações automáticas.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>

                    <div class="p-3 content-area overflow-auto flex-grow-1" style="height: calc(100% - 40px);">

                        <div id="interpretacoes-content">
                            <p class="mb-4" >
                                "Após o pico de Abril, o **Downtime** estabilizou-se em torno de 55. A projeção (Mock)
                                indica um aumento gradual para 65 até Setembro, **sugerindo atenção imediata**."
                            </p>

                            <p class="mb-0">
                                "A análise desta tendência de alertas foi realizada utilizando **Regressão Linear**
                                sobre o histórico semanal de dados. O **Índice de Confiabilidade** do modelo é de
                                **85%**, indicando alta aderência da projeção à variação real observada."
                            </p>
                        </div>

                        <div id="metricas-content" class="d-none">

                            <div
                                class="info-metric-card d-flex align-items-center justify-content-between p-3 mb-3 border rounded">
                                <div>
                                    <h6 class="mb-0">Coeficiente de Correlação (R)</h6>
                                    <p class="mb-0">10%</p>
                                </div>
                                <i class="bi bi-graph-up-arrow text-primary" style="font-size: 1.2rem;"></i>
                            </div>

                            <div
                                class="info-metric-card d-flex align-items-center justify-content-between p-3 mb-3 border rounded">
                                <div>
                                    <h6 class="mb-0">Coeficiente de Determinação (R²)</h6>
                                    <p class="mb-0">10%</p>
                                </div>
                                <i class="bi bi-graph-up-arrow text-primary" style="font-size: 1.2rem;"></i>
                            </div>

                            <div
                                class="info-metric-card d-flex align-items-center justify-content-between p-3 mb-3 border rounded">
                                <div>
                                    <h6 class="mb-0">Erro Padrão Residual (RSE)</h6>
                                    <p class="mb-0">10%</p>
                                </div>
                                <i class="bi bi-graph-up-arrow text-primary" style="font-size: 1.2rem;"></i>
                            </div>

                            <div
                                class="info-metric-card d-flex align-items-center justify-content-between p-3 border rounded">
                                <div>
                                    <h6 class="mb-0">Índice de Confiabilidade da Projeção</h6>
                                    <p class="mb-0">10%</p>
                                </div>
                                <i class="bi bi-graph-up-arrow text-primary" style="font-size: 1.2rem;"></i>
                            </div>

                        </div>

                    </div>

                </div>
            </div>
        </section>

        <section class="row g-4">
            <div class="col-lg-12">
                <div class="content-box">
                    <h5 class="mb-3" style="font-size: 1.1rem;">Ranking de Indisponibilidade
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="Top Máquinas com Downtime"
                            data-bs-content="Exibe as máquinas que tiveram a maior porcentagem de inatividade no período selecionado, priorizando aquelas com a maior variação negativa.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </h5>
                    <div class="table-responsive">
                        <table class="table table-hover table-sm">
                            <thead class="table-light">
                                <tr>
                                    <th>Nome</th>
                                    <th>Downtime(%)</th>
                                    <th>Dif. P. Passado</th>
                                    <th>Total de Alertas</th>
                                    <th>Dif. P. Passado</th>
                                    <th>Top1 Alerta da Máquina</th>
                                    <th>Top2 Alerta da Máquina</th>
                                    <th>Top3 Alerta da Máquina</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Máquina-001</td>
                                    <td>91%</td>
                                    <td class="text-danger">9%</td>
                                    <td class="text-success">+10%</td>
                                    <td>CPU - Crítico (150)</td>
                                    <td>CPU - Atenção (200)</td>
                                    <td>RAM - Crítico (200)</td>
                                    <td>
                                        <button class="btn btn-info btn-sm me-1"
                                            onclick="analisarMaquina('Máquina-001')">Analisar Máquina</button>
                                        <button class="btn btn-primary btn-sm"
                                            onclick="verHistorico('Máquina-001')">Histórico</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-matrix@2.0.0/dist/chartjs-chart-matrix.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <script src="../component/menu/Menu.js"></script>
    <script src="../component/notificao/Notificacao.js"></script>
    <script src="../component/tour/TourGuide.js"></script>
    <script src="../js/dash_analise_desempenho/01_config.js"></script>
    <script src="../js/dash_analise_desempenho/03_render.js"></script>
    <script src="../js/dash_analise_desempenho/02_filters.js"></script>
</body>
</html>