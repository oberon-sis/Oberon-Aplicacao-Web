<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>- OBERON</title>

    <link rel="icon" type="image/x-icon" href="../assets/marca/icone_pequeno.svg" />
    <link rel="stylesheet" href="../css/body.css" />
    <link rel="stylesheet" href="../component/menu/Menu.css" />
    <link rel="stylesheet" href="../component/notificao/Notificaocao.css">
    <link rel="stylesheet" href="../component/tour/TourGuide.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="../css/analiseHistorica.css">
</head>

<body class="d-flex w-100 h-100">
    <div id="menu-container"></div>

    <main class="content flex-grow-1 padding_main main dashboard-main">

        <header class="header-top d-flex justify-content-between align-items-center p-3 flex-shrink-0">
            <h2 class="text-black me-3">
                Análise Histórica de Desempenho: &nbsp;&nbsp; <span id="tituloDoPainel">Máquina-003</span>
            </h2>

            <div class="d-flex align-items-center flex-wrap flex-grow-1 me-3">
                <div class="d-flex align-items-center me-3 mb-2 mb-md-0">
                    <div class="search-autocomplete-container me-3" style="position: relative;">

                        <div class="input-group input-group-sm" style="width: 200px">
                            <input type="text" class="form-control" id="inputBusca"
                                placeholder="Buscar pelo nome da máquina" oninput="filtrarSugestoes(this.value)"
                                autocomplete="off" />
                            <span class="input-group-text"><i class="bi bi-search"></i></span>
                        </div>

                        <ul id="listaSugestoes" class="autocomplete-list dropdown-menu"
                            style="position: absolute; top: 100%; left: 0; width: 100%; display: none;">
                        </ul>
                    </div>

                    <p class="mx-2 mb-0 d-flex align-items-center">OU</p>

                    <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                        aria-expanded="false">
                        <span id="valor_pesquisa_maquina">Selecionar</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end hover_verde">
                        <li><a class="dropdown-item" onclick="atualizar_painelEspecifico(1)"></a></li>
                        <li><a class="dropdown-item" onclick="atualizar_painelEspecifico(2)"></a></li>
                        <li><a class="dropdown-item" onclick="atualizar_painelEspecifico(3)"></a></li>
                        <li><a class="dropdown-item" onclick="atualizar_painelEspecifico(4)"></a></li>
                        <li><a class="dropdown-item" onclick="atualizar_painelEspecifico(5)"></a></li>
                        <li><a class="dropdown-item" onclick="atualizar_painelEspecifico(6)"></a></li>
                    </ul>
                </div>
            </div>


        </header>


        <div class="main-structure" style="background-color: white;">
            <section class="kpi-container" id="kpi-section">
                <div class="kpi-card" id="kpi-disponibilidade" style="background-color: white;">
                    <div class="topo-kpi">
                        <h6>Taxa De Disponibilidade Do Sistema</h6>
                        <div class="icone-kpi"><i class="bi bi-box-arrow-in-up"></i></div>
                    </div>

                    <div class="baixo-kpi">
                        <div>
                            <span id="txt_disponibilidade" class="text-danger"> 97.8% <i class="bi bi-arrow-down"
                                    style="scale: 1.2"></i> </span>
                            <p>Semana passada: <span id="txt_disponibilidade_passado"></span></p>
                        </div>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="O que é Disponibilidade?"
                            data-bs-content="A porcentagem de tempo que o sistema ou máquina está operacional e acessível aos usuários durante o período de referência.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>

                <div class="kpi-card" id="kpi-total-alertas" style="background-color: white;">
                    <div class="topo-kpi">
                        <h6>Quantidade Total De Alertas</h6>
                        <div class="icone-kpi"><i class="bi bi-bell"></i></div>
                    </div>
                    <div class="baixo-kpi">
                        <div>
                            <span id="txt_total_alertas" class="text-danger"> 450 <i class="bi bi-arrow-up"
                                    style="scale: 1.2"></i> </span>
                            <p>Semana Passada: 380</p>
                        </div>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="O que são Alertas?"
                            data-bs-content="Total de notificações geradas por exceder limites configurados de uso de recursos (CPU, RAM, etc.) ou falhas no sistema durante o bimestre.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>

                <div class="kpi-card" id="kpi-percentual-critico" style="background-color: white;">
                    <div class="topo-kpi">
                        <h6>Percentual De alertas Críticos</h6>
                        <div class="icone-kpi">
                            <i class="bi bi-exclamation-triangle-fill"></i>
                        </div>
                    </div>
                    <div class="baixo-kpi">
                        <div>
                            <span id="txt_percentual_critico" class="text-danger"> 15% <i class="bi bi-arrow-up"
                                    style="scale: 1.2"></i> </span>
                            <p>Semana Passada: 8%</p>
                        </div>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="O que é Alerta Crítico?"
                            data-bs-content="A proporção de alertas que atingiram o nível de maior gravidade ('Crítico'), indicando falhas graves ou iminentes que exigem ação imediata.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>

                <div class="kpi-card" id="kpi-componente-critico" style="background-color: white;">
                    <div class="topo-kpi">
                        <h6>Componente Com Mais Alertas Criticos</h6>
                        <div class="icone-kpi"><i class="bi bi-memory"></i></div>
                    </div>

                    <div class="baixo-kpi" style="background-color: white;">
                        <div>
                            <span id="txt_componente_critico"> RAM </span>
                            <p>Semana Passada: CPU</p>
                        </div>
                        <button type="button" class="saber_mais btn btn-link" data-bs-toggle="popover"
                            data-bs-placement="right" data-bs-trigger="focus" data-bs-title="Componente Crítico"
                            data-bs-content="O recurso (CPU, RAM, DISCO, etc.) que gerou o maior número de alertas no nível 'Crítico' durante o bimestre analisado.">
                            <img src="../assets/svg/saber.svg" alt="Saiba Mais" class="icone-info" />
                        </button>
                    </div>
                </div>
            </section>

            <div class="row">
                <div class="col-md-6" style="background-color: white;">
                    <div class="data-card" id="garfico-linhas">
                        <h4 class="mb-3">Utilização Média de Recursos (CPU, RAM, DISCO)</h4>
                        <canvas id="mainChart"></canvas>
                    </div>
                </div>

                <div class="col-md-6" style="background-color: white;">
                    <div class="data-card" style="background-color: white;" id="grafico-barras">
                        <h4 class="mb-3">Total de Alertas por Componente (30 Dias)</h4>
                        <canvas id="componentAlertsChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12" style="background-color: white;">
                    <div class="data-card alert-events-card" id="tabela-eventos">
                        <h4 class="mb-3">Últimos Eventos de Alerta (24h)</h4>
                        <div class="table-responsive">
                            <table class="table table-sm compact-alert-table">
                                <thead>
                                    <tr>
                                        <th>Hora</th>
                                        <th>Componente</th>
                                        <th>Alerta</th>
                                        <th>Valor</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-alertas">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="../component/menu/Menu.js"></script>
    <script src="../component/tour/TourGuide.js"></script>
    <script src="../js/dashboard/dashboard_maquina_especifica/tour_especifica.js"></script>
    <script src="../component/notificao/Notificacao.js"></script>
    <script src="../js/dashboard/dashboard_maquina_especifica/dashboardEspecifica.js"></script>
</body>

</html>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Inicializa APENAS o gráfico restante (uptime/downtime)
        initUptimeDowntimeChart();

        // A inicialização do AlertTrendChart é feita no próprio script alertTrendChart.js

        // Inicializa os popovers (se a função foi movida para utils.js)
        if (typeof initializeBootstrap === "function") {
            initializeBootstrap();
        }
    });


    // MOCK DE DADOS: Lista de máquinas para simular a busca
    const LISTA_MAQUINAS = [];

    console.log("-------------AQUI--------")


    /**
     * Função principal de autocompletar. Chamada no evento oninput do campo de busca.
     * @param {string} termoBusca - O texto digitado pelo usuário.
     */
    function filtrarSugestoes(termoBusca) {
        const listaSugestoesEl = document.getElementById('listaSugestoes');
        const termo = termoBusca.trim().toUpperCase();

        // 1. Limpa e Oculta a lista se o termo estiver vazio
        if (termo.length < 2) { // Começa a filtrar a partir de 2 ou 3 caracteres
            listaSugestoesEl.innerHTML = '';
            listaSugestoesEl.style.display = 'none';
            return;
        }

        // 2. Filtra os dados
        const resultados = LISTA_MAQUINAS.filter(maquina =>
            maquina.nome.toUpperCase().includes(termo)
        );
        console.log("-------------AQUI--------")

        console.log(LISTA_MAQUINAS)

        // 3. Constrói o HTML da lista
        let html = '';

        if (resultados.length > 0) {
            resultados.forEach(maquina => {
                // Usa a classe dropdown-item e adiciona um evento de clique
                html += `
                <li>
                    <a class="dropdown-item" href="#" 
                       onclick="selecionarMaquina('${nomeMaquina}', ${idMaquina}); return false;">
                        ${maquina.nome}
                    </a>
                </li>
            `;
            });
        } else {
            // Mensagem de "nenhum resultado"
            html = `<li><span class="dropdown-item text-muted">Nenhuma máquina encontrada.</span></li>`;
        }

        // 4. Exibe os resultados
        listaSugestoesEl.innerHTML = html;
        listaSugestoesEl.style.display = 'block';
    }

    /**
     * Função chamada ao clicar em uma sugestão.
     * @param {string} nome - Nome completo da máquina.
     * @param {number} id - ID da máquina.
     */
    function selecionarMaquina(nome, id) {
        const inputBuscaEl = document.getElementById('inputBusca');
        const listaSugestoesEl = document.getElementById('listaSugestoes');

        // 1. Preenche o campo de busca com o nome selecionado
        inputBuscaEl.value = nome;

        // 2. Oculta a lista de sugestões
        listaSugestoesEl.style.display = 'none';

        // 3. Ação Principal: Atualiza o painel para a máquina selecionada
        // Você deve chamar a função que carrega os dados da máquina aqui:
        // por exemplo: atualizar_painelEspecifico(id);

        console.log(`Máquina selecionada: ${nome} (ID: ${id}). Iniciando carregamento do painel...`);
    }

    document.addEventListener('DOMContentLoaded', () => {
        const nomeMaquina = sessionStorage.getItem('maquinaSelecionadaNome');
        const idMaquina = sessionStorage.getItem('maquinaSelecionadaId');

        // 2. Identifica o elemento de destino (o <h1>)
        const tituloElemento = document.getElementById('tituloDoPainel');

        if (nomeMaquina && tituloElemento) {
            tituloElemento.innerHTML = `${nomeMaquina}`;
        } else {
            if (tituloElemento) {
                tituloElemento.innerHTML = 'Maquina-001';
            }
        }
        // carregarDadosDoGrafico(idMaquina); 
    });
</script>